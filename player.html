<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="strict-origin-when-cross-origin" />

<style>
:root {
  --yt-red: #ff0000;
  --white: rgba(255,255,255,.95);
  --dim: rgba(255,255,255,.65);
  --track: rgba(255,255,255,.25);
}

html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  background: #000;
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

#player-root {
  position: relative;
  width: 100%;
  height: 100%;
}

#youTubePlayer {
  width: 100%;
  height: 100%;
}

/* ---------- Controls ---------- */

.controls {
  position: absolute;
  left: 12px;
  right: 12px;
  bottom: 10px;
  padding: 10px 12px 12px;
  border-radius: 12px;
  background: linear-gradient(
    to top,
    rgba(0,0,0,.75),
    rgba(0,0,0,.2),
    rgba(0,0,0,0)
  );
  opacity: 0;
  transition: opacity .25s ease;
}

#player-root:hover .controls {
  opacity: 1;
}

.seekbar {
  width: 100%;
  height: 3px;
  margin-bottom: 10px;
  appearance: none;
  background: var(--track);
}

.seekbar::-webkit-slider-thumb {
  appearance: none;
  width: 11px;
  height: 11px;
  border-radius: 50%;
  background: var(--yt-red);
}

.row {
  display: flex;
  align-items: center;
  gap: 14px;
}

button {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  color: var(--dim);
  transition: color .2s ease, transform .15s ease;
}

button:hover {
  color: var(--white);
  transform: scale(1.08);
}

.icon {
  width: 18px;
  height: 18px;
  fill: currentColor;
}

.volume {
  width: 70px;
  height: 3px;
  appearance: none;
  background: var(--track);
}

.volume::-webkit-slider-thumb {
  appearance: none;
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--yt-red);
}

.time {
  font-size: 12px;
  font-weight: 500;
  color: var(--dim);
  min-width: 96px;
}
</style>

<script src="https://www.youtube.com/iframe_api" async></script>
</head>

<body>

<div id="player-root">
  <div id="youTubePlayer"></div>

  <!-- UI ONLY -->
  <div class="controls">
    <input id="seekBar" class="seekbar" type="range" min="0" max="100" value="0">

    <div class="row">
      <button id="playBtn"></button>
      <button id="muteBtn"></button>
      <input id="volumeBar" class="volume" type="range" min="0" max="100" value="100">
      <div id="timeLabel" class="time">0:00 / 0:00</div>
      <button id="fsBtn">⛶</button>
    </div>
  </div>
</div>

<script>
/* ============================================================
   ORIGINAL WORKING CODE — UNCHANGED
   ============================================================ */

const q = new URLSearchParams(location.search);
const videoId = q.get("videoId") || "";
const startAt = parseFloat(q.get("start") || "0");

const STATES = {
  [-1]: "UNSTARTED",
  0: "ENDED",
  1: "PLAYING",
  2: "PAUSED",
  3: "BUFFERING",
  5: "CUED",
};

let player, timer;

function onYouTubeIframeAPIReady() {
  player = new YT.Player("youTubePlayer", {
    width: "100%",
    height: "100%",
    playerVars: {
      autoplay: 1,
      controls: 0,
      cc_load_policy: 0,
      fs: 1,
      iv_load_policy: 3,
      rel: 0,
      enablejsapi: 1,
      mute: 1,
      playsinline: 1,
      origin: location.origin,
      modestbranding: 1,
      disablekb: 1,
      showinfo: 0,
    },
    events: {
      onReady: () => {
        document.title = "ytplayer://onReady";
        if (videoId) loadVideo(videoId, startAt);
      },
      onStateChange: (e) => stateChanged(e.data),
      onError: (e) =>
        (document.title = "ytplayer://onError?data=" + e.data),
    },
  });
}

function stateChanged(s) {
  clearInterval(timer);
  document.title = "ytplayer://onStateChange?data=" + (STATES[s] || "");

  if (s === 1) {
    timer = setInterval(() => {
      try {
        const t = player.getCurrentTime();
        document.title = "ytplayer://onCurrentTimeChange?data=" + t;
        updateUI(t);
      } catch (e) {}
    }, 200);

    try {
      const d = player.getDuration();
      if (d > 0)
        document.title = "ytplayer://onVideoDuration?data=" + d;
    } catch (e) {}
  }
}

function loadVideo(id, sec) {
  if (player && player.loadVideoById) {
    player.loadVideoById(id, sec || 0);
    document.title = "ytplayer://onVideoId?data=" + id;
  }
}

function playVideo() { player.playVideo(); }
function pauseVideo() { player.pauseVideo(); }
function seekTo(s) { player.seekTo(s, true); }
function mute() { player.mute(); }
function unMute() { player.unMute(); }

function setVolume(v) {
  if (!player) return;
  v = Math.max(0, Math.min(100, Math.round(v)));
  player.setVolume(v);
  v === 0 ? mute() : unMute();
}

/* ============================================================
   UI LAYER (ADDED ONLY)
   ============================================================ */

const ICONS = {
  play: `<svg class="icon" viewBox="0 0 24 24"><polygon points="6,4 20,12 6,20"/></svg>`,
  pause: `<svg class="icon" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>`,
  volume: `<svg class="icon" viewBox="0 0 24 24"><polygon points="3,9 7,9 12,4 12,20 7,15 3,15"/></svg>`,
  mute: `<svg class="icon" viewBox="0 0 24 24"><polygon points="3,9 7,9 12,4 12,20 7,15 3,15"/><line x1="16" y1="8" x2="22" y2="16" stroke="white" stroke-width="2"/><line x1="22" y1="8" x2="16" y2="16" stroke="white" stroke-width="2"/></svg>`
};

let isPlaying = false;
let isMuted = false;
let duration = 0;

function updateUI(t) {
  try {
    duration = player.getDuration() || 0;
    seekBar.value = duration ? (t / duration) * 100 : 0;
    timeLabel.textContent = fmt(t) + " / " + fmt(duration);
  } catch (e) {}
}

const fmt = s => {
  const m = Math.floor(s / 60);
  const r = Math.floor(s % 60);
  return m + ":" + (r < 10 ? "0" : "") + r;
};

playBtn.onclick = () => {
  isPlaying = !isPlaying;
  isPlaying ? playVideo() : pauseVideo();
  playBtn.innerHTML = isPlaying ? ICONS.pause : ICONS.play;
};

muteBtn.onclick = () => {
  isMuted = !isMuted;
  isMuted ? mute() : unMute();
  muteBtn.innerHTML = isMuted ? ICONS.mute : ICONS.volume;
};

volumeBar.oninput = e => setVolume(e.target.value);

seekBar.oninput = e =>
  duration && seekTo((e.target.value / 100) * duration);

fsBtn.onclick = () =>
  document.title = "ytplayer://onFullscreenToggle";

playBtn.innerHTML = ICONS.play;
muteBtn.innerHTML = ICONS.volume;
</script>

</body>
</html>
