<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
        font-family: system-ui, -apple-system, BlinkMacSystemFont;
      }

      #youTubePlayer {
        width: 100%;
        height: 100%;
      }
      
      #speedBtn {
        font-size: 13px;
        font-weight: 600;
        color: var(--control-dim);
      }

      /* ---------- Controls Overlay ---------- */

      .controls {
        position: absolute;
        left: 12px;
        right: 12px;
        bottom: 10px;
        padding: 10px 12px 12px;
        border-radius: 12px;
        background: linear-gradient(
          to top,
          rgba(0,0,0,0.65),
          rgba(0,0,0,0.15),
          rgba(0,0,0,0)
        );
        opacity: 0;
        transition: opacity 0.25s ease;
      }

      body:hover .controls {
        opacity: 1;
      }

      .seekbar {
        width: 100%;
        height: 3px;
        margin-bottom: 8px;
        appearance: none;
        background: var(--track-bg);
        border-radius: 2px;
      }
      .seekbar::-webkit-slider-thumb {
        appearance: none;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--control-white);
      }
      .row {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      button {
        background: none;
        border: none;
        color: var(--control-dim);
        font-size: 16px;
        cursor: pointer;
        padding: 0;
      }

      button:hover {
        color: var(--control-white);
      }

      input[type=range] {
        appearance: none;
        height: 3px;
        background: rgba(255,255,255,.4);
        border-radius: 2px;
        cursor: pointer;
      }

      input[type=range]::-webkit-slider-thumb {
        appearance: none;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: white;
      }

      .volume {
        width: 70px;
        height: 3px;
        appearance: none;
        background: var(--track-bg);
      }
      .volume::-webkit-slider-thumb {
        appearance: none;
        width: 9px;
        height: 9px;
        border-radius: 50%;
        background: var(--control-white);
      }

      .time {
        font-size: 12px;
        font-weight: 500;
        color: var(--control-dim);
        min-width: 92px;
      }
    </style>

    <script src="https://www.youtube.com/iframe_api" async></script>
  </head>

  <body>
    <div id="youTubePlayer"></div>

    <!-- -------- Controls UI -------- -->
    <div class="controls">
      <input id="seekBar" class="seekbar" type="range" min="0" max="100" value="0">

      <div class="row">
        <button id="playBtn">â–¶</button>
        <button id="muteBtn">ðŸ”Š</button>
        <input id="volumeBar" class="volume" type="range" min="0" max="100" value="100">
        <div id="timeLabel" class="time">0:00 / 0:00</div>
        <button id="speedBtn">1x</button>
        <button id="fsBtn">â›¶</button>
      </div>
    </div>

    <script>
      const q = new URLSearchParams(location.search);
      const videoId = q.get("videoId") || "";
      const startAt = parseFloat(q.get("start") || "0");

      const STATES = {
        [-1]: "UNSTARTED",
        0: "ENDED",
        1: "PLAYING",
        2: "PAUSED",
        3: "BUFFERING",
        5: "CUED",
      };

      let player, timer;
      let duration = 0;
      let isMuted = false;
      let isPlaying = false;

      function onYouTubeIframeAPIReady() {
        player = new YT.Player("youTubePlayer", {
          width: "100%",
          height: "100%",
          playerVars: {
            autoplay: 1,
            controls: 0,
            cc_load_policy: 0,
            fs: 1,
            iv_load_policy: 3,
            rel: 0,
            enablejsapi: 1,
            mute: 1,
            playsinline: 1,
            origin: location.origin,
            modestbranding: 1,
            disablekb: 1,
            showinfo: 0,
          },
          events: {
            onReady: () => {
              document.title = "ytplayer://onReady";
              if (videoId) loadVideo(videoId, startAt);
            },
            onStateChange: (e) => stateChanged(e.data),
            onError: (e) =>
              (document.title = "ytplayer://onError?data=" + e.data),
          },
        });
      }

      function stateChanged(s) {
        clearInterval(timer);
        document.title = "ytplayer://onStateChange?data=" + (STATES[s] || "");

        isPlaying = s === 1;
        playBtn.textContent = isPlaying ? "â¸" : "â–¶";

        if (s === 1) {
          timer = setInterval(updateTime, 250);

          try {
            duration = player.getDuration();
            if (duration > 0)
              document.title = "ytplayer://onVideoDuration?data=" + duration;
          } catch (e) {}
        }
      }

      function updateTime() {
        try {
          const t = player.getCurrentTime();
          document.title =
            "ytplayer://onCurrentTimeChange?data=" + t;

          seekBar.value = duration ? (t / duration) * 100 : 0;
          timeLabel.textContent = format(t) + " / " + format(duration);
        } catch (e) {}
      }

      function format(s) {
        if (!s) return "0:00";
        const m = Math.floor(s / 60);
        const r = Math.floor(s % 60);
        return m + ":" + (r < 10 ? "0" : "") + r;
      }

      /* -------- Existing API (unchanged) -------- */

      function loadVideo(id, sec) {
        if (player && player.loadVideoById) {
          player.loadVideoById(id, sec || 0);
          document.title = "ytplayer://onVideoId?data=" + id;
        }
      }

      function playVideo() {
        if (player && player.playVideo) player.playVideo();
      }

      function pauseVideo() {
        if (player && player.pauseVideo) player.pauseVideo();
      }

      function seekTo(s) {
        if (player && player.seekTo) player.seekTo(s, true);
      }

      function mute() {
        if (player && player.mute) player.mute();
      }

      function unMute() {
        if (player && player.unMute) player.unMute();
      }

      function setVolume(volumePercent) {
        if (!player || typeof player.setVolume !== "function") return;
        player.setVolume(volumePercent);
        if (volumePercent === 0) mute(); else unMute();
      }

      function setPlaybackRate(r) {
        if (player && player.setPlaybackRate) player.setPlaybackRate(r);
      }

      /* -------- UI bindings (thin layer) -------- */

      playBtn.onclick = () => {
        isPlaying ? pauseVideo() : playVideo();
      };

      muteBtn.onclick = () => {
        isMuted = !isMuted;
        isMuted ? mute() : unMute();
        muteBtn.textContent = isMuted ? "ðŸ”‡" : "ðŸ”Š";
      };

      volumeBar.oninput = e => setVolume(e.target.value);

      seekBar.oninput = e => {
        if (!duration) return;
        seekTo((e.target.value / 100) * duration);
      };

      fsBtn.onclick = () =>
        document.title = "ytplayer://onFullscreenToggle";
    </script>
  </body>
</html>
