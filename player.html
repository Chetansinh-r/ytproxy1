<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="strict-origin-when-cross-origin" />

<style>
:root {
  --control-white: rgba(255,255,255,0.92);
  --control-dim: rgba(255,255,255,0.65);
  --control-fade: rgba(255,255,255,0.45);
  --track-bg: rgba(255,255,255,0.25);
}

html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  background: #000;
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

#youTubePlayer {
  width: 100%;
  height: 100%;
}

/* ---------- Controls Overlay ---------- */

.controls {
  position: absolute;
  left: 12px;
  right: 12px;
  bottom: 10px;
  padding: 10px 12px 12px;
  border-radius: 12px;
  background: linear-gradient(
    to top,
    rgba(0,0,0,0.65),
    rgba(0,0,0,0.15),
    rgba(0,0,0,0)
  );
  opacity: 0;
  transition: opacity .25s ease;
}

body:hover .controls {
  opacity: 1;
}

/* ---------- Seekbar ---------- */

.seekbar {
  width: 100%;
  height: 3px;
  margin-bottom: 8px;
  appearance: none;
  background: var(--track-bg);
  border-radius: 2px;
}

.seekbar::-webkit-slider-thumb {
  appearance: none;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--control-white);
}

/* ---------- Control Row ---------- */

.row {
  display: flex;
  align-items: center;
  gap: 14px;
}

button {
  background: none;
  border: none;
  color: var(--control-dim);
  cursor: pointer;
  padding: 0;
  transition: color .2s ease, transform .15s ease;
}

button:hover {
  color: var(--control-white);
  transform: scale(1.08);
}

/* ---------- Icons ---------- */

.icon {
  width: 18px;
  height: 18px;
  fill: currentColor;
}

/* ---------- Volume ---------- */

.volume {
  width: 70px;
  height: 3px;
  appearance: none;
  background: var(--track-bg);
  border-radius: 2px;
}

.volume::-webkit-slider-thumb {
  appearance: none;
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--control-white);
}

/* ---------- Time ---------- */

.time {
  font-size: 12px;
  font-weight: 500;
  color: var(--control-dim);
  min-width: 92px;
}

/* ---------- Speed Menu ---------- */

.speed-container {
  position: relative;
}

.speed-menu {
  position: absolute;
  bottom: 28px;
  right: 0;
  background: rgba(20,20,20,.9);
  border-radius: 8px;
  padding: 6px 0;
  display: none;
}

.speed-menu button {
  display: block;
  padding: 6px 14px;
  font-size: 13px;
  width: 100%;
  text-align: left;
}

.speed-menu button.active {
  color: var(--control-white);
  font-weight: 600;
}
</style>

<script src="https://www.youtube.com/iframe_api" async></script>
</head>

<body>

<div id="youTubePlayer"></div>

<div class="controls">
  <input id="seekBar" class="seekbar" type="range" min="0" max="100" value="0">

  <div class="row">
    <button id="playBtn"></button>
    <button id="muteBtn"></button>
    <input id="volumeBar" class="volume" type="range" min="0" max="100" value="100">
    <div id="timeLabel" class="time">0:00 / 0:00</div>

    <div class="speed-container">
      <button id="speedBtn">1x</button>
      <div class="speed-menu" id="speedMenu">
        <button data-rate="0.5">0.5x</button>
        <button data-rate="1" class="active">1x</button>
        <button data-rate="1.5">1.5x</button>
        <button data-rate="2">2x</button>
      </div>
    </div>

    <button id="fsBtn">â›¶</button>
  </div>
</div>

<script>
const q = new URLSearchParams(location.search);
const videoId = q.get("videoId") || "";
const startAt = parseFloat(q.get("start") || "0");

let player, timer;
let duration = 0;
let isPlaying = false;
let isMuted = false;

/* ---------- YouTube ---------- */

function onYouTubeIframeAPIReady() {
  player = new YT.Player("youTubePlayer", {
    playerVars: {
      autoplay: 1,
      controls: 0,
      mute: 1,
      enablejsapi: 1,
      origin: location.origin
    },
    events: {
      onReady: () => videoId && loadVideo(videoId, startAt),
      onStateChange: e => stateChanged(e.data)
    }
  });
}

function stateChanged(s) {
  clearInterval(timer);
  isPlaying = s === 1;
  updatePlayIcon();

  if (isPlaying) {
    timer = setInterval(updateTime, 250);
    duration = player.getDuration() || 0;
  }
}

function updateTime() {
  const t = player.getCurrentTime();
  seekBar.value = duration ? (t / duration) * 100 : 0;
  timeLabel.textContent = format(t) + " / " + format(duration);
}

function format(s) {
  const m = Math.floor(s / 60);
  const r = Math.floor(s % 60);
  return m + ":" + (r < 10 ? "0" : "") + r;
}

/* ---------- API (unchanged) ---------- */

function loadVideo(id, sec) { player.loadVideoById(id, sec || 0); }
function playVideo() { player.playVideo(); }
function pauseVideo() { player.pauseVideo(); }
function mute() { player.mute(); }
function unMute() { player.unMute(); }
function setVolume(v) { player.setVolume(v); v == 0 ? mute() : unMute(); }
function seekTo(s) { player.seekTo(s, true); }
function setPlaybackRate(r) { player.setPlaybackRate(r); }

/* ---------- UI Bindings ---------- */

function updatePlayIcon() {
  playBtn.innerHTML = isPlaying ? "âšâš" : "â–¶";
}

function updateMuteIcon() {
  muteBtn.innerHTML = isMuted ? "ðŸ”‡" : "ðŸ”Š";
}

playBtn.onclick = () => isPlaying ? pauseVideo() : playVideo();

muteBtn.onclick = () => {
  isMuted = !isMuted;
  isMuted ? mute() : unMute();
  updateMuteIcon();
};

volumeBar.oninput = e => setVolume(e.target.value);

seekBar.oninput = e =>
  duration && seekTo((e.target.value / 100) * duration);

/* ---------- Speed ---------- */

speedBtn.onclick = () =>
  speedMenu.style.display =
    speedMenu.style.display === "block" ? "none" : "block";

speedMenu.querySelectorAll("button").forEach(btn => {
  btn.onclick = () => {
    setPlaybackRate(btn.dataset.rate);
    speedBtn.textContent = btn.dataset.rate + "x";
    speedMenu.style.display = "none";
    speedMenu.querySelectorAll("button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  };
});

fsBtn.onclick = () =>
  document.title = "ytplayer://onFullscreenToggle";

updatePlayIcon();
updateMuteIcon();
</script>

</body>
</html>
