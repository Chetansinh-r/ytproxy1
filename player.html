<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="strict-origin-when-cross-origin" />

<script src="https://www.youtube.com/iframe_api" async></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

#container {
  position: relative;
  width: 100%;
  height: 100%;
}

#youTubePlayer {
  width: 100%;
  height: 100%;
}

/* ---------- Controls ---------- */

#controls {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 12px;
  background: linear-gradient(to top, rgba(0,0,0,.75), transparent);
  box-sizing: border-box;
}

#seekbar {
  width: 100%;
  margin-bottom: 10px;
}

input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 4px;
  border-radius: 4px;
  background: linear-gradient(to right, #ff0000 0%, #444 0%);
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: #ff0000;
  border-radius: 50%;
}

.row {
  display: flex;
  align-items: center;
  gap: 14px;
}

.group {
  display: flex;
  align-items: center;
  gap: 6px;
}

button {
  background: none;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.9;
}

button:hover {
  opacity: 1;
}

#time {
  color: #fff;
  font-size: 13px;
  min-width: 70px;
}

#volume {
  width: 80px;
}

#right {
  margin-left: auto;
  display: flex;
  gap: 14px;
}

select {
  background: rgba(0,0,0,0.6);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 4px;
  padding: 3px 6px;
}
</style>
</head>

<body>
<div id="container">
  <div id="youTubePlayer"></div>

  <div id="controls">
    <input id="seekbar" type="range" min="0" max="100" value="0">

    <div class="row">
      <button id="play">‚ñ∂</button>

      <div class="group">
        <button id="mute">üîä</button>
        <input id="volume" type="range" min="0" max="100" value="100">
      </div>

      <div id="time">0:00 / 0:00</div>

      <div id="right">
        <select id="speed">
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>

        <button id="fullscreen">‚õ∂</button>
      </div>
    </div>
  </div>
</div>

<script>
/* =======================
   YOUR WORKING PLAYER CODE
   (UNCHANGED)
======================= */

const q = new URLSearchParams(location.search);
const videoId = q.get("videoId") || "";
const startAt = parseFloat(q.get("start") || "0");

const STATES = {
  [-1]: "UNSTARTED",
  0: "ENDED",
  1: "PLAYING",
  2: "PAUSED",
  3: "BUFFERING",
  5: "CUED",
};

let player, timer;

function onYouTubeIframeAPIReady() {
  player = new YT.Player("youTubePlayer", {
    width: "100%",
    height: "100%",
    playerVars: {
      autoplay: 1,
      controls: 0,
      fs: 1,
      rel: 0,
      mute: 1,
      playsinline: 1,
      enablejsapi: 1,
      origin: location.origin,
      modestbranding: 1,
      disablekb: 1,
    },
    events: {
      onReady: () => {
        document.title = "ytplayer://onReady";
        if (videoId) loadVideo(videoId, startAt);
      },
      onStateChange: e => stateChanged(e.data),
      onError: e => document.title = "ytplayer://onError?data=" + e.data,
    }
  });
}

function stateChanged(s) {
  clearInterval(timer);
  document.title = "ytplayer://onStateChange?data=" + (STATES[s] || "");

  if (s === 1) {
    timer = setInterval(updateUI, 300);
    document.title = "ytplayer://onVideoDuration?data=" + player.getDuration();
  }
}

function loadVideo(id, sec) {
  player.loadVideoById(id, sec || 0);
  document.title = "ytplayer://onVideoId?data=" + id;
}

function playVideo(){ player.playVideo(); }
function pauseVideo(){ player.pauseVideo(); }
function seekTo(s){ player.seekTo(s, true); }
function mute(){ player.mute(); }
function unMute(){ player.unMute(); }
function setVolume(v){ player.setVolume(v); }
function setPlaybackRate(r){ player.setPlaybackRate(r); }

/* =======================
   UI WIRING ONLY
======================= */

const playBtn = document.getElementById("play");
const seekbar = document.getElementById("seekbar");
const time = document.getElementById("time");
const muteBtn = document.getElementById("mute");
const volume = document.getElementById("volume");
const speed = document.getElementById("speed");
const fullscreen = document.getElementById("fullscreen");

playBtn.onclick = () => {
  const s = player.getPlayerState();
  s === 1 ? pauseVideo() : playVideo();
};

muteBtn.onclick = () => {
  if (player.isMuted()) {
    unMute();
    muteBtn.textContent = "üîä";
  } else {
    mute();
    muteBtn.textContent = "üîá";
  }
};

volume.oninput = e => {
  setVolume(e.target.value);
  muteBtn.textContent = e.target.value == 0 ? "üîá" : "üîä";
};

seekbar.oninput = e => {
  const t = player.getDuration() * (e.target.value / 100);
  seekTo(t);
};

speed.onchange = e => {
  setPlaybackRate(parseFloat(e.target.value));
  document.title = "ytplayer://onPlaybackRate?data=" + e.target.value;
};

fullscreen.onclick = () => {
  document.title = "ytplayer://onFullscreen";
};

function updateUI() {
  const cur = player.getCurrentTime();
  const dur = player.getDuration();
  if (!dur) return;

  const p = (cur / dur) * 100;
  seekbar.value = p;
  seekbar.style.background =
    `linear-gradient(to right,#ff0000 ${p}%,#444 ${p}%)`;

  time.textContent =
    format(cur) + " / " + format(dur);

  playBtn.textContent =
    player.getPlayerState() === 1 ? "‚ùö‚ùö" : "‚ñ∂";
}

function format(s) {
  const m = Math.floor(s / 60);
  const ss = Math.floor(s % 60);
  return m + ":" + (ss < 10 ? "0" : "") + ss;
}
</script>
</body>
</html>
