<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Enhanced YouTube Player</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script defer src="https://www.youtube.com/iframe_api"></script>
        <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #youTubePlayer {
            width: 100%;
            height: 100%;
            display: block;
            pointer-events: none;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        .controller-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            z-index: 10;
            transition: opacity 0.3s;
            opacity: 1;
        }
        
        .controller-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            background: rgba(0, 0, 0, 0.7);
            z-index: 20;
            transition: opacity 0.3s;
        }

        .top-nav.hidden {
            opacity: 0;
            pointer-events: none !important;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-display {
            font-size: 14px;
            font-variant-numeric: tabular-nums;
            min-width: 40px;
            text-align: center;
        }
        
        .seek-bar {
            flex: 1;
            height: 6px;
            background: #444;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .progress {
            height: 100%;
            background: #f00;
            border-radius: 3px;
            width: 0%;
            position: relative;
        }
        
        .progress::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .seek-bar:hover .progress::after {
            opacity: 1;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            pointer-events: auto;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .volume-slider {
            width: 80px;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 2px;
            background: #555;
            outline: none;
            transition: all 0.2s;
            opacity: 0.7;
            pointer-events: auto;
        }
        
        .volume-slider:hover {
            opacity: 1;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
        }
        
        .playback-speed {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        select {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            pointer-events: auto;
        }
        
        
        /* Thumbnail Overlay */
        .thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            background-color: #000;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s;
            opacity: 1;
            pointer-events: none;
        }
        
        .thumbnail-overlay.hidden {
            opacity: 0;
            pointer-events: none !important;
        }
        
        /* Loading Indicator */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #fff;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }
        
        
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .controller-overlay {
                padding: 10px;
            }
            
            .control-btn {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            
            .volume-slider {
                width: 60px;
            }
            
            .spinner {
                width: 40px;
                height: 40px;
                border-width: 4px;
            }
            
            .loading-text {
                font-size: 16px;
            }
        }
        </style>
    </head>
    <body>
        <div class="top-nav" id="topNav">
            <button class="nav-btn" id="backBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>

        <div id="player-container">
            <div id="youTubePlayer"></div>
            <div class="video-overlay" id="videoOverlay"></div>
            <div class="thumbnail-overlay" id="thumbnailOverlay"></div>
            <div class="loading-indicator" id="loadingIndicator">
                <div class="spinner"></div>
                <div class="loading-text">Loading Video...</div>
            </div>
        </div>

        <div class="controller-overlay" id="controllerOverlay">
            <div class="progress-container">
                <div class="time-display" id="currentTime">0:00</div>
                <div class="seek-bar" id="seekBar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time-display" id="duration">0:00</div>
            </div>
            <div class="controls">
                <div class="left-controls">
                    <button class="control-btn" id="playPauseBtn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" id="muteBtn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <div class="volume-container">
                        <input
                            type="range"
                            min="0"
                            max="100"
                            value="80"
                            class="volume-slider"
                            id="volumeSlider"
                        >
                    </div>
                    <div class="time-display" id="timeIndicator">0:00 / 0:00</div>
                </div>
                <div class="right-controls">
                    <div class="playback-speed">
                        <select id="speedSelect">
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>
                    </div>

                    <button class="control-btn" id="fullscreenBtn">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>
        <script>

        // Player variables
        var player;
        var timerId;
        var isSeeking = false;
        var controllerTimeout;
        
        // DOM Elements
        const playPauseBtn = document.getElementById('playPauseBtn');
        const muteBtn = document.getElementById('muteBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const speedSelect = document.getElementById('speedSelect');
        const currentTimeDisplay = document.getElementById('currentTime');
        const durationDisplay = document.getElementById('duration');
        const timeIndicator = document.getElementById('timeIndicator');
        const seekBar = document.getElementById('seekBar');
        const progress = document.getElementById('progress');
        const controllerOverlay = document.getElementById('controllerOverlay');
        const videoOverlay = document.getElementById('videoOverlay');
        const thumbnailOverlay = document.getElementById('thumbnailOverlay');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const backBtn = document.getElementById('backBtn');
        const topNav = document.getElementById('topNav');



        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        var videoId = getQueryParam('videoId') || '';
        var durationInitialized = false;
        let lastSeek = 0;
        let controlsUIHidden= true
        let hideBackButton= true
        
        // Format time to MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // Initialize player
        function onYouTubeIframeAPIReady() {
            setControlsUIHidden(controlsUIHidden, hideBackButton);

            player = new YT.Player('youTubePlayer', {
                height: '100%',
                width: '100%',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                },
                playerVars: {
                    disablekb: 1,
                    autoplay: 1,
                    controls: 0,
                    cc_load_policy: 0,
                    fs: 1,
                    iv_load_policy: 3,
                    rel: 0,
                    loop: 1,
                    mute: 1,
                    enablejsapi: 1,
                    playsinline: 1,
                    origin: "https://www.youtube.com",
                    showinfo: 0,
                    modestbranding: 1
                }
            });
        }

        function dispatchCallback(name,data){document.title=`ytplayer://${name}?data=${data}`;}
        
        // Player ready callback
        function onPlayerReady(event) {
            dispatchCallback('onReady', 'true');
            if (videoId) loadVideo(videoId, "0");
            // Hide YouTube controls
            hidePlayerControls();
        }

        function loadVideo(id,sec=0){
            if(!player)return;
            durationInitialized=false
            videoId=id;
            player.loadVideoById(id,sec);
            dispatchCallback('onVideoId',id);

           // Set initial volume
            player.setVolume(parseInt(volumeSlider.value));
            
            // Set initial playback rate
            player.setPlaybackRate(parseFloat(speedSelect.value));
            
            
            // Set initial duration
            const duration = player.getDuration();
            // durationDisplay.textContent = formatTime(duration);
            timeIndicator.textContent = `0:00 / ${formatTime(duration)}`;
            
            // Start UI update interval
            setInterval(updateUI, 100);
            
            // Set controller timeout
            startControllerTimeout();
            
            // Set thumbnail overlay
            setThumbnailBackground();
        }

        
        // Set thumbnail background
        function setThumbnailBackground() {
            const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
            thumbnailOverlay.style.backgroundImage = `url('${thumbnailUrl}')`;
        }
        
       
        
        // Player state change callback
        function onPlayerStateChange(event) {
            updatePlayPauseIcon();
            dispatchCallback('onStateChange',event.data);

            if (!durationInitialized &&
                (event.data === YT.PlayerState.CUED ||
                 event.data === YT.PlayerState.PLAYING)) {

                const d = player.getDuration();
                if (d && !isNaN(d)) {
                    dispatchCallback('onVideoDuration', d);
                    durationDisplay.textContent = formatTime(d);
                    durationInitialized = true;
                }
            }
            
            if (isEffectivelyPlaying()) {
                thumbnailOverlay.classList.add('hidden');
                loadingIndicator.style.display = 'none';
                startControllerTimeout();
            }
            else if (event.data === YT.PlayerState.PAUSED) {
                // Show thumbnail overlay when paused
                thumbnailOverlay.classList.remove('hidden');
                loadingIndicator.style.display = 'none';
                
            } 
            else if (event.data === YT.PlayerState.BUFFERING) {
                // Show loading indicator when buffering
                thumbnailOverlay.classList.remove('hidden');
                loadingIndicator.style.display = 'flex';
                
               
            }
            else if (event.data === YT.PlayerState.ENDED) {
                // Show thumbnail when video ends
                thumbnailOverlay.classList.remove('hidden');
                loadingIndicator.style.display = 'none';
               
                
            }
            else if (event.data === YT.PlayerState.CUED) {
                // Show thumbnail when video is cued
                thumbnailOverlay.classList.remove('hidden');
                loadingIndicator.style.display = 'none';
               
                
            }
        }
        
        // Player error callback
        function onPlayerError(event) {
            console.error('Player error:', event.data);
            // Show error message
            loadingIndicator.querySelector('.loading-text').textContent = 'Error loading video';
        }
        
        // Update UI elements
        function updateUI() {
            if (!player || typeof player.getCurrentTime !== 'function') return;
            
            if (isEffectivelyPlaying()) {
                thumbnailOverlay.classList.add('hidden');
                loadingIndicator.style.display = 'none';
            }

            // Update current time
            const currentTime = player.getCurrentTime();
            currentTimeDisplay.textContent = formatTime(currentTime);
            dispatchCallback('onCurrentTimeChange', currentTime);
            
            // Update time indicator
            timeIndicator.textContent = `${formatTime(currentTime)} / ${formatTime(player.getDuration())}`;
            
            // Update progress bar if not currently seeking
            if (!isSeeking) {
                const duration = player.getDuration();
                const percent = (currentTime / duration) * 100;
                progress.style.width = `${percent}%`;
            }

        }
        
        // Update play/pause icon based on player state
        function updatePlayPauseIcon() {
            const icon = playPauseBtn.querySelector('i');
            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
            } else {
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
            }
        }
        
        // Hide YouTube's native controls
        function hidePlayerControls() {
            const playerElement = document.getElementById('youTubePlayer');
            const playerDocument = playerElement.contentDocument || playerElement.contentWindow.document;
            
            if (playerDocument) {
                const style = playerDocument.createElement('style');
                style.textContent = `
                    .ytp-chrome-top, .ytp-chrome-bottom, 
                    .ytp-progress-bar, .ytp-title, 
                    .ytp-watermark, .ytp-gradient-top, 
                    .ytp-gradient-bottom, .ytp-show-cards-title,
                    .ytp-button, .ytp-large-play-button,
                    .ytp-cards-button, .ytp-pause-overlay,
                    .ytp-mute-button, .ytp-fullscreen-button,
                    .ytp-play-button, .ytp-next-button,
                    .ytp-prev-button, .ytp-settings-button,
                    .ytp-overflow-button, .ytp-miniplayer-button {
                        display: none !important;
                        opacity: 0 !important;
                        pointer-events: none !important;
                    }
                    
                    html, body {
                        cursor: none !important;
                    }
                `;
                playerDocument.head.appendChild(style);
            }
        }

        function isEffectivelyPlaying() {
            if (!player) return false;

            const state = player.getPlayerState();
            const t = player.getCurrentTime();

            // Normal playing
            if (state === YT.PlayerState.PLAYING) return true;

            // Ads case: time is moving but state isn't PLAYING
            if (
                t > 0 &&
                (state === YT.PlayerState.UNSTARTED ||
                 state === YT.PlayerState.CUED ||
                 state === YT.PlayerState.BUFFERING)
            ) {
                return true;
            }

            return false;
        }


        
        function playVideo(){
            if(!player) return;
            if (player.getPlayerState() === YT.PlayerState.PLAYING) return;

            player.playVideo();
            updatePlayPauseIcon();
        }

        function pauseVideo(){
            if(!player) return;
            if (player.getPlayerState() === YT.PlayerState.PAUSED) return;

            player.pauseVideo();
            updatePlayPauseIcon();
        }

        function unMute(){
            if(!player) return;
            if (!player.isMuted()) return;

            player.unMute();
            const icon = muteBtn.querySelector('i');
            icon.classList.remove('fa-volume-mute');
            icon.classList.add('fa-volume-up');
        }

        function mute(){
            if(!player) return;
            if (player.isMuted()) return;

            player.mute();
            const icon = muteBtn.querySelector('i');
            icon.classList.remove('fa-volume-up');
            icon.classList.add('fa-volume-mute');
        }

        function setPlaybackRate(r){
            if(!player) return;

            const rate = Number(r);
            const currentRate = player.getPlaybackRate();

            if (currentRate === rate) return;

            player.setPlaybackRate(rate);
            speedSelect.value = rate.toString();
        }

        function setVolume(v){
            if(!player) return;

            v = Math.max(0, Math.min(100, Number(v)));
            const current = player.getVolume();

            if (current === v) return;

            volumeSlider.value = v;
            player.setVolume(v);

            if (v === 0) {
                mute();
            } else {
                unMute();
            }
        }

        function seekTo(s){
            if(player){
                player.seekTo(s,true);
            }
        }

        function setFullscreenUI(isFullscreen) {
            const icon = fullscreenBtn.querySelector('i');
            icon.classList.toggle('fa-expand', !isFullscreen);
            icon.classList.toggle('fa-compress', isFullscreen);
        }


        function debounce(fn, delay) {
            let t;
            return function (...args) {
                clearTimeout(t);
                t = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        const debouncedVolumeCallback = debounce((v) => {
            dispatchCallback('onVolumeChange', v);
        }, 150);



        backBtn.addEventListener('click', function () {
            dispatchCallback('onBackPressed', 'true');
        });


        
        // Event Listeners
        playPauseBtn.addEventListener('click', function() {
            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                pauseVideo();
                dispatchCallback('onPauseChange', true);
            } else {
                playVideo();
                dispatchCallback('onPauseChange', false);
            }
            startControllerTimeout();
        });
        
       
        
        
        
        muteBtn.addEventListener('click', function() {
            if (player.isMuted()) {
                unMute();
                dispatchCallback('onMuteChange', false);
            } else {
                mute();
                dispatchCallback('onMuteChange', true);
            }
            startControllerTimeout();
        });

        fullscreenBtn.addEventListener('click', function () {
            dispatchCallback('onFullscreenToggle', 'true');
            startControllerTimeout();
        });

        
        volumeSlider.addEventListener('input', function() {
            player.setVolume(parseInt(this.value));
            
            if (parseInt(this.value) === 0) {
                mute();
            } else {
                unMute();
               
            }
            
            debouncedVolumeCallback(this.value);

            startControllerTimeout();
        });
        
        speedSelect.addEventListener('change', function() {
            dispatchCallback('onPlaybackRateChange', this.value);
            player.setPlaybackRate(parseFloat(this.value));
            startControllerTimeout();
        });
        
        // Seek bar functionality
        seekBar.addEventListener('mousedown', function(e) {
            isSeeking = true;
            handleSeek(e);
        });
        
        document.addEventListener('mousemove', function(e) {
            if (isSeeking) {
                handleSeek(e);
            }
        });
        
        document.addEventListener('mouseup', function() {
            isSeeking = false;
        });
        
        seekBar.addEventListener('click', function(e) {
            if (!isSeeking) {
                handleSeek(e);
            }
        });
        
        function handleSeek(e) {
            const now = Date.now();
            if (now - lastSeek < 100) return; // throttle
            lastSeek = now;

            if (!player || !player.getDuration) return;
            
            const rect = seekBar.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            const newTime = player.getDuration() * percent;
            
            player.seekTo(newTime, true);
            progress.style.width = `${percent * 100}%`;
            
            startControllerTimeout();
        }
        
        // Controller visibility timeout
        function startControllerTimeout() {
            if (controlsUIHidden) return;
            controllerOverlay.classList.remove('hidden');
            if(!hideBackButton) topNav.classList.remove('hidden');
            
            clearTimeout(controllerTimeout);
            controllerTimeout = setTimeout(() => {
                controllerOverlay.classList.add('hidden');
                if (!hideBackButton) {
                    topNav.classList.add('hidden');
                }
            }, 3000);
        }

        function setControlsUIHidden(hidden, hideBack) {
            controlsUIHidden = !!hidden;
            hideBackButton = !!hideBack;


            if (controlsUIHidden || hideBackButton) {
                topNav.classList.add('hidden');
            } else {
                topNav.classList.remove('hidden');
            }

            if (controlsUIHidden) {
                controllerOverlay.classList.add('hidden');
            } else {
                controllerOverlay.classList.remove('hidden');
                startControllerTimeout();
            }
        }

        
        // Show controller on mouse move
        document.addEventListener('mousemove', function(e) {
            if (controlsUIHidden) return;
            // Update cursor trail position
            
            // Show controls
            if(!hideBackButton) topNav.classList.remove('hidden');
            controllerOverlay.classList.remove('hidden');
            startControllerTimeout();
            
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (controlsUIHidden) return;
            if (e.target.tagName.toLowerCase() === 'input') return;
            
            switch (e.key) {
                case ' ':
                case 'k':
                    playPauseBtn.click();
                    e.preventDefault();
                    break;
                case 'm':
                    muteBtn.click();
                    break;
                case 'ArrowLeft':
                    player.seekTo(player.getCurrentTime() - 5, true);
                    break;
                case 'ArrowRight':
                    player.seekTo(player.getCurrentTime() + 5, true);
                    break;
                case 'ArrowUp':
                    volumeSlider.value = Math.min(100, parseInt(volumeSlider.value) + 10);
                    volumeSlider.dispatchEvent(new Event('input'));
                    break;
                case 'ArrowDown':
                    volumeSlider.value = Math.max(0, parseInt(volumeSlider.value) - 10);
                    volumeSlider.dispatchEvent(new Event('input'));
                    break;
                case 'f':
                    // Toggle fullscreen
                    const container = document.getElementById('player-container');
                    if (!document.fullscreenElement) {
                        if (container.requestFullscreen) {
                            container.requestFullscreen();
                        }
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        }
                    }
                    break;
                case 'u':
                    // Unmute with keyboard shortcut
                    if (player.isMuted()) {
                        unMute();
                        dispatchCallback('onMuteChange', false);
                        volumeSlider.value = 80;
                        player.setVolume(80);
                       
                    }
                    break;
            }
            
            startControllerTimeout();
        });


        document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});
        </script>
    </body>
</html>
